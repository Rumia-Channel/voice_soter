# ごちゃ混ぜから音声ファイルを分離するための補助ソフト

シンプルにタイトルの通りです。  
勝手にユーザーディレクトリにフォルダを作って、勝手にプロジェクトファイル(実際の音声データは含まない)を作成します。

## 実行方法（uv プロジェクト）

このプロジェクトは **uv** を使って実行します。

```bash
uv sync
uv run python main.py
```

これで依存関係（PySide6 など）が自動的にインストールされ、アプリが起動します。

---

## 基本の流れ

1. **プロジェクトを選択または作成**

   * 起動時にダイアログが表示されます。何も指定しない場合は `default` が自動で作成されます。

2. **出力フォルダを設定**

   * 音声を仕分ける先のフォルダを指定します。キャラ名ごとのフォルダが自動生成されます。

3. **キャラクター名を登録**

   * 音声を分けるためのキャラクター名を登録します。
   * スペースを含めてもOK（フォルダ作成時に自動で `_` に置換）。
   * 入力した名前は前方一致で補完され、一意になった時点で自動確定＆入力ロックされます。
   * **Backspace** でロック解除＋1文字削除が可能。

4. **入力フォルダを追加**

   * 複数追加可。再帰探索の ON/OFF も選択できます。

5. **仕分け開始**

   * 音声を再生しながらキャラ名を入力 → Enter で仕分け。
   * 仕分けが完了すると、自動的に次のファイルへ進みます。

---

## 操作一覧

| 操作         | キー                              | 説明                                          |
| ---------- | ------------------------------- | ------------------------------------------- |
| 再生/停止      | `Space`                         | 音声ファイルを再生または停止                              |
| 仕分け確定      | `Enter` / `Return`              | 入力したキャラ名フォルダへ移動                             |
| 除外         | `Del`                           | `_excluded_by_voice_sorter` に移動             |
| 後回し        | `Shift + Space`                 | `_deferred_by_voice_sorter` に移動（仕分け完了後に再処理） |
| Undo（取り消し） | `Ctrl + Z`                      | 直前の仕分けを元に戻す                                 |
| Redo（やり直し） | `Ctrl + Shift + Z` / `Ctrl + Y` | 取り消しをやり直す                                   |
| ロック解除＋削除   | `Backspace`（ロック時）               | 入力ロックを解除しつつ1文字削除                            |
| 名前への空白の挿入 | `Ctrl + Space` | `Space` を押すと音声ファイルが再生されてしまうため、名前に空白を入れるには `Ctrl + Space` を押さねばならない。 |

---

## 入力補完の動作

* 登録されたキャラクター名は前方一致で補完されます。
* 一意になった瞬間に自動確定し、入力がロックされます。
* 例：`Abraham`, `Rinna`, `Eito`, `Elsa` の場合

  * `A` → `Abraham` が確定
  * `Ei` → `Eito` が確定
  * `el` → `Elsa` が確定

---

## ファイルの扱い

* 除外 (`Del`)：元フォルダに `_excluded_by_voice_sorter` を作って移動。
* 後回し (`Shift + Space`)： `_deferred_by_voice_sorter` に移動し、仕分け完了後に再処理対象として復帰。
* すべての操作はプロジェクトごとに履歴（Undo/Redo）で記録・復元可能です。

---

## 注意点

* 出力フォルダを選ばずに仕分けようとすると警告が出ます。
* 入力ロック中は IME 確定・右クリック・ドラッグ操作が無効化されます。
* Undo/Redo はアプリ独自の履歴を使うため、再起動後でも復元可能です。

